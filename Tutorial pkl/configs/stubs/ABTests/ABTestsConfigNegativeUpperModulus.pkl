import "../../../templates/ABTestsTemplate.pkl"

local ab0 = ABTestsTemplate.abtests[0]
local variants0 = ab0.variants
local newVariant0 = variants0[0].toMap()
  .mapValues((key, value) ->
    if (key == "modulus") value.toMap()
      .mapValues((k, v) -> if (k == "upper") -50 else v)
      .toDynamic()
    else value
  )
  .toDynamic()
local newAb0 = ab0.toMap()
  .mapValues((key, value) ->
    if (key == "variants") new Listing { newVariant0; variants0[1] }
    else value
  )
  .toDynamic()

output {
  renderer = new JsonRenderer { omitNullProperties = false }
  value = new Listing {
    newAb0
    ABTestsTemplate.abtests[1]
  }
}
